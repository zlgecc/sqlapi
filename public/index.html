<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Test SQLrest</title>
    <script src="https://cdn.staticfile.org/vue/3.2.30/vue.global.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="style.css"></link>
  </head>
  <body>
    <div id="app">
      <div class="container">
        <div class="header">
          <input class="search_url" type="text" placeholder="请输入地址" v-model="query" />
          <button class="search_btn" @click="search">搜索</button>
        </div>
        <div class="body">
          <div class="table_frame">
            <table class="table_data">
              <thead>
                <tr>
                  <th v-for="item in table_data.header">{{item}}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="data in table_data.data">
                  <td scope="row" v-for="item in data">{{item}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <!-- <div class="footer">
          <span>Token</span>
          <input type="text" class="token_input" v-model="token" />
        </div> -->
      </div>
    </div>

    <script>
      const App = {
        data() {
          return {
            host: "",
            query: "/api/user",
            table_data: {
              header: [],
              data: [],
            },
            token: "",
          };
        },
        mounted() {
          console.log("mounted...");
          this.host = "http://" + document.location.host
        },
        methods: {
          search: function () {
            const url = `${this.host}${this.query}`;
            console.log(url)

            const token = this.token

            const table_data = this.table_data

            axios
              .get(url, {
                headers: {
                  'Content-type': 'application/json'
                },
              })
              .then(function (res) {
                console.log(res.data)
                list = res.data.data.list;
                table_head = new Set();
                table_body = [];
                list.forEach((data) => {
                  item_data = [];
                  for (var key in data) {
                    table_head.add(key);
                    item_data.push(data[key]);
                  }
                  table_body.push(item_data);
                });
                table_data.header = table_head;
                table_data.data = table_body;
              })
              .catch(function (error) {
                console.log(error);
              });
          },
        },
      };

      Vue.createApp(App).mount("#app");
    </script>
  </body>
</html>
